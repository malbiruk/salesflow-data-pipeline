version: 2

models:
  - name: performance_by_channel
    description: "Comparison of online vs offline sales channels"
    tests:
      - dbt_utils.equality:
          compare_model: ref('performance_by_channel_snapshot')
    columns:
      - name: sales_channel
        description: "Online or Offline sales channel"
        tests:
          - not_null
          - accepted_values:
              values: ["Online", "Offline"]
      - name: total_revenue
        description: "Total revenue generated by the channel"
        tests:
          - not_null
          - dbt_utils.expression_is_true:
              expression: ">= 0"

  - name: performance_by_order_priority
    description: "Order metrics broken down by priority level"
    columns:
      - name: order_priority
        description: "Priority level of orders (H, M, L, C)"
        tests:
          - not_null
          - accepted_values:
              values: ["H", "M", "L", "C"]
      - name: avg_days_to_ship
        description: "Average days between order and shipment date"
        tests:
          - not_null
          - dbt_utils.expression_is_true:
              expression: ">= 0"

  - name: performance_by_region
    description: "Sales performance metrics by geographic region and country"
    columns:
      - name: region
        description: "Geographic region"
        tests:
          - not_null
          - relationships:
              to: ref('region')
              field: region
      - name: total_revenue
        tests:
          - not_null
          - dbt_utils.expression_is_true:
              expression: ">= 0"

  - name: product_performance
    description: "Sales performance metrics by product type"
    columns:
      - name: item_type
        description: "Type of product"
        tests:
          - not_null
          - relationships:
              to: ref('product')
              field: item_type
      - name: profit_margin
        description: "Profit as percentage of revenue"
        tests:
          - dbt_utils.expression_is_true:
              expression: "<= 100.0"

  - name: revenue_by_date
    description: "Daily revenue and profit trends"
    columns:
      - name: order_date
        description: "Date of order"
        tests:
          - not_null
      - name: total_revenue
        description: "Total revenue for the day"
        tests:
          - not_null
          - dbt_utils.expression_is_true:
              expression: ">= 0"
